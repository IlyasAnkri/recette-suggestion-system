# Story 5.1: Set up Angular 20 Project with PWA and NgRx

## Status: Ready for Review

## Story
**As a** developer,  
**I want** an Angular 20 project configured with PWA and state management,  
**so that** frontend development can begin with proper architecture.

## Acceptance Criteria
1. Angular 20 project created with standalone components
2. @angular/pwa package configured with service worker and manifest
3. NgRx store, effects, and entity packages installed
4. Angular Material configured with custom theme
5. Lazy-loaded routing structure defined
6. Environment configurations for dev/staging/prod

## Tasks / Subtasks
- [x] Task 1: Create Angular project (AC: 1)
  - [x] Run `ng new recipe-adjuster-web --standalone`
  - [x] Configure TypeScript strict mode
  - [x] Set up project structure (core, features, shared)

- [x] Task 2: Add PWA support (AC: 2)
  - [x] Run `ng add @angular/pwa`
  - [x] Configure manifest.webmanifest (name, icons, theme)
  - [x] Configure ngsw-config.json

- [x] Task 3: Add NgRx (AC: 3)
  - [x] Install @ngrx/store, @ngrx/effects, @ngrx/entity
  - [x] Configure root store
  - [x] Set up NgRx DevTools for development

- [x] Task 4: Configure Angular Material (AC: 4)
  - [x] Run `ng add @angular/material`
  - [x] Create custom theme (primary, accent, warn)
  - [x] Configure typography

- [x] Task 5: Set up routing (AC: 5)
  - [x] Configure lazy-loaded routes
  - [x] Define routes: home, search, recipes, profile, auth

- [x] Task 6: Configure environments (AC: 6)
  - [x] Create environment.ts (dev)
  - [x] Create environment.staging.ts
  - [x] Create environment.prod.ts
  - [x] Configure API base URLs

## Dev Notes

### Project Structure
```
src/
├── app/
│   ├── core/           # Singleton services, guards, interceptors
│   ├── features/       # Feature modules (lazy-loaded)
│   │   ├── home/
│   │   ├── recipe-search/
│   │   ├── recipe-detail/
│   │   ├── substitutions/
│   │   ├── auth/
│   │   └── profile/
│   ├── shared/         # Shared components, pipes, directives
│   └── store/          # NgRx root store
├── assets/
├── environments/
└── styles/
```

### File Locations
- Project root: `frontend/`
- App config: `frontend/src/app/app.config.ts`
- Routes: `frontend/src/app/app.routes.ts`
- Store: `frontend/src/app/store/`

## Dev Agent Record

### Agent Model Used
Cascade (Claude 3.7 Sonnet)

### Completion Notes
- Angular 20 project created with SSR and zoneless configuration
- NgRx 18 installed with --legacy-peer-deps for Angular 20 compatibility
- Angular Material 20 configured with Material 2 theme API
- PWA support added with manifest and service worker configuration
- Lazy-loaded routing structure implemented for all feature modules
- Environment configurations created for dev, staging, and production
- Build successful with prerendering for static routes and server rendering for dynamic routes

### File List
- frontend/src/app/app.config.ts (modified)
- frontend/src/app/app.routes.ts (modified)
- frontend/src/app/app.routes.server.ts (modified)
- frontend/src/app/store/index.ts (created)
- frontend/src/app/features/home/home.routes.ts (created)
- frontend/src/app/features/recipe-search/recipe-search.routes.ts (created)
- frontend/src/app/features/recipe-detail/recipe-detail.routes.ts (created)
- frontend/src/app/features/substitutions/substitutions.routes.ts (created)
- frontend/src/app/features/auth/auth.routes.ts (created)
- frontend/src/app/features/profile/profile.routes.ts (created)
- frontend/src/environments/environment.ts (created)
- frontend/src/environments/environment.staging.ts (created)
- frontend/src/environments/environment.prod.ts (created)
- frontend/src/styles/theme.scss (created)
- frontend/src/styles.scss (modified)
- frontend/public/manifest.webmanifest (modified)
- frontend/ngsw-config.json (created)
- frontend/package.json (modified)

## Testing

### Test Cases
1. ✓ Angular app builds without errors
2. ✓ Service worker registers on production build
3. ✓ NgRx store initializes correctly
4. ✓ Routes lazy-load feature modules

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-20 | 1.0 | Initial story creation | Bob (SM) |
| 2025-12-21 | 1.1 | Implementation complete | James (Dev) |
 
 ## QA Results
 
 ### Review Date: 2025-12-21
 
 ### Reviewed By: Quinn (Test Architect)
 
 ### Code Quality Assessment
 
 - Angular 20 + SSR + zoneless setup is aligned with project architecture.
 - NgRx, Material, PWA, and environment configuration match the acceptance criteria.
 - Project structure (core/features/shared/store) follows the documented source tree.
 
 ### Refactoring Performed
 
 - None during QA review (advisory review only).
 
 ### Compliance Check
 
 - Coding Standards: ✓ (structure and strict TS mode are consistent with guidelines)
 - Project Structure: ✓ (matches docs/architecture/source-tree.md)
 - Testing Strategy: ~ (manual test cases documented; automated tests recommended for smoke checks)
 - All ACs Met: ✓
 
 ### Improvements Checklist
 
 - [ ] Add a minimal E2E smoke test to verify app boot and main routes render.
 - [ ] Add a short README section describing SSR + PWA interaction and known constraints.
 
 ### Security Review
 
 - No auth or sensitive data handling in this story; no security issues identified.
 
 ### Performance Considerations
 
 - Lazy-loaded feature routes and strict TS configuration provide a good baseline.
 - Later performance work (Story 5.9) should validate bundle size and SSR timings.
 
 ### Files Modified During Review
 
 - None (story-level QA only).
 
 ### Gate Status
 
 - Gate: PASS → docs/qa/gates/5.1-angular-project-setup.yml
 
 ### Recommended Status
 
 - ✓ Ready for Done (for this story).
