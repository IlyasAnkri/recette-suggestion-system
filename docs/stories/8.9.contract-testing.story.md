# Story 8.9: Implement Contract Testing with Pact

## Status: Draft

## Story
**As a** developer,  
**I want** contract tests between services,  
**so that** API changes don't break consumers.

## Acceptance Criteria
1. Pact Broker set up (pactflow.io free tier or self-hosted)
2. Pact provider tests added to all 8 microservices
3. Pact consumer tests added to API Gateway
4. Kafka event schema validation with Schema Registry
5. Contract tests run in CI (fail on violations)
6. Contract testing workflow documented

## Tasks / Subtasks
- [ ] Task 1: Set up Pact Broker (AC: 1)
  - [ ] Create PactFlow account or self-host
  - [ ] Configure access tokens

- [ ] Task 2: Add provider tests (AC: 2)
  - [ ] Add Pact provider to each service
  - [ ] Verify against contracts

- [ ] Task 3: Add consumer tests (AC: 3)
  - [ ] Define expected contracts
  - [ ] Publish to broker

- [ ] Task 4: Schema Registry (AC: 4)
  - [ ] Configure Confluent Schema Registry
  - [ ] Validate Kafka events

- [ ] Task 5: CI integration (AC: 5)
  - [ ] Add to CI workflow
  - [ ] Fail on contract violations

- [ ] Task 6: Document workflow (AC: 6)
  - [ ] Write contract testing guide
  - [ ] Document versioning strategy

## Dev Notes

### Pact Provider Test
```java
@Provider("ingredient-matching-service")
@PactBroker
class IngredientMatchingProviderTest {
    
    @TestTemplate
    @ExtendWith(PactVerificationInvocationContextProvider.class)
    void verifyPact(PactVerificationContext context) {
        context.verifyInteraction();
    }
}
```

## Testing

### Test Cases
1. Provider verifies consumer contract
2. Contract violation fails build
3. Schema Registry validates events
4. New API version updates contract

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-20 | 1.0 | Initial story creation | Bob (SM) |
