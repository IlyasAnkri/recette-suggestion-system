# Story 8.7: Configure Database and Kafka Deployments

## Status: Draft

## Story
**As a** DevOps engineer,  
**I want** databases and Kafka deployed and configured,  
**so that** services have data persistence and messaging.

## Acceptance Criteria
1. MongoDB Atlas free tier (512MB, shared cluster)
2. PostgreSQL on Render (90 days free, then Supabase)
3. Confluent Cloud Kafka (free tier: 1 cluster, 1GB)
4. Connection strings stored in GitHub Secrets
5. Migration procedure documented (Render â†’ Supabase)
6. Weekly database backup scripts

## Tasks / Subtasks
- [ ] Task 1: Set up MongoDB Atlas (AC: 1)
  - [ ] Create Atlas account
  - [ ] Create cluster
  - [ ] Configure network access
  - [ ] Create database user

- [ ] Task 2: Set up PostgreSQL (AC: 2)
  - [ ] Create Render PostgreSQL
  - [ ] Note connection string
  - [ ] Run migration scripts

- [ ] Task 3: Set up Kafka (AC: 3)
  - [ ] Create Confluent Cloud cluster
  - [ ] Create topics
  - [ ] Generate API keys

- [ ] Task 4: Store secrets (AC: 4)
  - [ ] Add to GitHub Secrets
  - [ ] Add to Render env vars

- [ ] Task 5: Document migration (AC: 5)
  - [ ] Write migration guide
  - [ ] Test Supabase migration

- [ ] Task 6: Create backup scripts (AC: 6)
  - [ ] MongoDB export script
  - [ ] PostgreSQL dump script
  - [ ] Weekly GitHub Actions job

## Dev Notes

### Free Tier Limits
- MongoDB Atlas: 512MB, shared cluster
- Render PostgreSQL: 90 days free
- Confluent Cloud: 1 cluster, 1GB storage

## Testing

### Test Cases
1. Services connect to databases
2. Kafka topics accessible
3. Backup script runs successfully
4. Restore from backup works

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-20 | 1.0 | Initial story creation | Bob (SM) |
