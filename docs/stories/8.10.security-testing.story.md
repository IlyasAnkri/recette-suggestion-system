# Story 8.10: Implement Automated Security Testing

## Status: Draft

## Story
**As a** security engineer,  
**I want** automated security scans in CI,  
**so that** vulnerabilities are detected before deployment.

## Acceptance Criteria
1. OWASP ZAP scanning in CI (baseline and full scans)
2. Dependabot enabled for dependency vulnerabilities
3. Snyk for container image scanning
4. JWT token security tests (expiry, signature)
5. SQL/NoSQL injection tests in integration tests
6. Fail build on high-severity vulnerabilities

## Tasks / Subtasks
- [ ] Task 1: Add OWASP ZAP (AC: 1)
  - [ ] Add ZAP GitHub Action
  - [ ] Configure baseline scan
  - [ ] Configure full scan on release

- [ ] Task 2: Enable Dependabot (AC: 2)
  - [ ] Create dependabot.yml
  - [ ] Configure for Maven and npm

- [ ] Task 3: Add Snyk (AC: 3)
  - [ ] Add Snyk to Docker build
  - [ ] Scan images before push

- [ ] Task 4: JWT security tests (AC: 4)
  - [ ] Test expired token rejection
  - [ ] Test invalid signature rejection
  - [ ] Test token refresh security

- [ ] Task 5: Injection tests (AC: 5)
  - [ ] Add SQL injection test cases
  - [ ] Add NoSQL injection test cases

- [ ] Task 6: Quality gates (AC: 6)
  - [ ] Fail on high-severity CVEs
  - [ ] Block deployment on critical issues

## Dev Notes

### OWASP ZAP Action
```yaml
- name: OWASP ZAP Scan
  uses: zaproxy/action-baseline@v0.10.0
  with:
    target: 'https://staging.recipe-adjuster.com'
```

### Dependabot Configuration
```yaml
version: 2
updates:
  - package-ecosystem: "maven"
    directory: "/services"
    schedule:
      interval: "weekly"
  - package-ecosystem: "npm"
    directory: "/frontend"
    schedule:
      interval: "weekly"
```

## Testing

### Test Cases
1. ZAP scan runs and produces report
2. Dependabot creates PRs for vulnerabilities
3. Snyk blocks vulnerable images
4. JWT tests pass
5. Injection tests detect vulnerabilities

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-20 | 1.0 | Initial story creation | Bob (SM) |
