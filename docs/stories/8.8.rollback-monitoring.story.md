# Story 8.8: Implement Rollback Procedures and Deployment Monitoring

## Status: Draft

## Story
**As a** DevOps engineer,  
**I want** documented rollback procedures and deployment monitoring,  
**so that** I can quickly recover from failed deployments.

## Acceptance Criteria
1. Rollback procedure documented (revert commit, redeploy)
2. Rollback script created (`scripts/rollback.sh`)
3. Render configured to keep last 3 deployments
4. Deployment monitoring (health checks every 5 min)
5. Runbook for common issues
6. Deployment history tracked

## Tasks / Subtasks
- [ ] Task 1: Document rollback (AC: 1)
  - [ ] Write rollback steps
  - [ ] Include Git commands

- [ ] Task 2: Create rollback script (AC: 2)
  - [ ] Revert last commit
  - [ ] Trigger redeploy

- [ ] Task 3: Configure Render retention (AC: 3)
  - [ ] Keep previous deployments
  - [ ] Enable one-click rollback

- [ ] Task 4: Set up monitoring (AC: 4)
  - [ ] UptimeRobot or similar
  - [ ] Health check endpoints
  - [ ] Alert on failure

- [ ] Task 5: Create runbook (AC: 5)
  - [ ] Common issues
  - [ ] Resolution steps

- [ ] Task 6: Track deployments (AC: 6)
  - [ ] Log to database
  - [ ] Include version, timestamp, status

## Dev Notes

### Rollback Script
```bash
#!/bin/bash
git revert HEAD --no-edit
git push origin main
# Trigger Render deploy hooks
curl -X POST $RENDER_DEPLOY_HOOK_URL
```

### Runbook Topics
- Service won't start
- Database connection failure
- Kafka unavailable
- High error rate

## Testing

### Test Cases
1. Rollback script reverts and redeploys
2. Render shows previous deployments
3. Health check alerts on failure
4. Runbook covers main scenarios

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-20 | 1.0 | Initial story creation | Bob (SM) |
